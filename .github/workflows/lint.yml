name: Lint (CloudFormation + GitHub Actions)

on:
  pull_request:
    branches: [ dev, main ]
    paths:
      - "infra/**"
      - ".github/workflows/**"
  push:
    branches: [ dev, main ]
    paths:
      - "infra/**"
      - ".github/workflows/**"
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install cfn-lint
        run: |
          pip install cfn-lint

      - name: cfn-lint (CloudFormation)
        run: |
          cfn-lint infra/dev/template.yaml
          if [ -f infra/prod/template.yaml ]; then cfn-lint infra/prod/template.yaml; fi

      - name: actionlint (GitHub Workflows)
        uses: devops-actions/actionlint@v0.1.10
